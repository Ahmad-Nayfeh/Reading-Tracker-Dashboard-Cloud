import streamlit as st
import db_manager as db
import auth_manager

st.set_page_config(
    page_title="عن التطبيق",
    page_icon="❓",
    layout="wide"
)

# This CSS snippet enforces RTL and adds custom styles for the page
st.markdown("""
    <style>
        /* Main app container */
        .stApp {
            direction: rtl;
        }
        /* Sidebar */
        [data-testid="stSidebar"] {
            direction: rtl;
        }
        /* Ensure text alignment is right for various elements */
        h1, h2, h3, h4, h5, h6, p, li, .st-bk, .st-b8, .st-b9, .st-ae {
            text-align: right !important;
        }
        /* Fix for radio buttons label alignment */
        .st-b8 label {
            text-align: right !important;
            display: block;
        }
        /* Fix for selectbox label alignment */
        .st-ae label {
            text-align: right !important;
            display: block;
        }
        
        /* Custom styles for the expander to make it look like a section card */
        .st-expander {
            border: 1px solid #e0e0e0 !important;
            border-radius: 12px !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05) !important;
            margin-bottom: 20px !important;
        }
        .st-expander header {
            font-size: 1.5em !important;
            font-weight: bold !important;
            color: #2980b9 !important;
            padding-top: 15px !important;
            padding-bottom: 15px !important;
        }
        .st-expander [data-testid="stExpanderDetails"] {
            padding: 0 20px 20px 20px !important;
        }
        .st-expander [data-testid="stExpanderDetails"] p, 
        .st-expander [data-testid="stExpanderDetails"] li {
            font-size: 1.1em !important;
            line-height: 1.8 !important;
        }
        .st-expander [data-testid="stExpanderDetails"] h4 {
            color: #2c3e50;
            margin-top: 15px;
        }
    </style>
""", unsafe_allow_html=True)


# --- UNIFIED AUTHENTICATION BLOCK ---
creds = auth_manager.authenticate()
user_id = st.session_state.get('user_id')

if not creds or not user_id:
    st.error("مصادقة المستخدم مطلوبة. يرجى العودة إلى الصفحة الرئيسية وتسجيل الدخول.")
    st.stop()
# -----------------------------------------


st.title("❓ عن تطبيق ماراثون القراءة")
st.markdown("---")
st.markdown("أهلاً بك في الدليل الشامل! هنا، ستجد كل ما تحتاج لمعرفته حول كيفية عمل التطبيق، من فلسفة النقاط إلى شرح الألقاب والأخبار.")


# --- Section 1: Philosophy of Points ---
with st.expander("🎯 نظام المسابقات والنقاط: فلسفة التحفيز الذكي", expanded=True):
    st.markdown("""
    هذا هو قلب المشروع النابض، وهو مصمم لتحقيق توازن دقيق بين القراءة الجماعية المنظمة والقراءة الفردية الحرة، لخلق جو حماسي ومرن. يقوم النظام على الأفكار التالية:

    #### حرية الاختيار هي الأساس
    لا يوجد مسار إلزامي. العضو لديه الحرية الكاملة ليختار المسار الذي يناسبه:
    - **مسار الكتاب المشترك:** يقرأ الكتاب الذي تم اختياره للتحدي. إنهاؤه يمنحه **دفعة هائلة من النقاط** تقديرًا لالتزامه وتهيئته لجلسة النقاش.
    - **مسار الكتاب الحر:** يقرأ أي كتاب آخر من اختياره. هنا، تتضاعف نقاطه بناءً على **وقت القراءة**، لكن نقاط إنهاء الكتاب تكون أقل.
    
    ويمكن للعضو أن يمشي بالمسارين معًا في وقت واحد، أو حتى يقرأ عدة كتب حرة! الأمر متروك له ولهمّته.

    #### منطق النقاط الذكي للموازنة
    - **للتشجيع على الالتزام:** نقاط إنهاء الكتاب المشترك **أعلى بكثير**.
    - **لتعزيز المشاركة المجتمعية:** حضور جلسة النقاش الخاصة بالكتاب المشترك يمنح نقاطًا إضافية.
    - **لتشجيع القراءة العميقة:** إضافة **اقتباس** من كتاب يقرأه العضو يمنحه نقاطًا إضافية، مما يحفزه على التفاعل مع النص بشكل أعمق.

    #### دورة حياة التحديات
    - **بداية جديدة للجميع:** كل ماراثون يبدأ ونقاطه صفر، مما يعطي فرصة متجددة للمنافسة.
    - **مكافأة الاجتهاد المستمر:** يتم تجميع كل النقاط في لوحة التحكم العامة لتقدير الأبطال الحقيقيين على المدى الطويل.
    - **جوائز وهدايا:** في نهاية كل تحدٍ، يمكن تقديم جوائز لأصحاب المراكز العليا، مثل أن يقوم الفائز باختيار الكتاب المشترك للماراثون القادم.
    """)

# --- Section 2: Hall of Fame Explained ---
with st.expander("🌟 فك شفرة الأبطال: شرح لوحة الشرف"):
    st.markdown("""
    لوحة شرف الأبطال هي احتفاء بالإنجازات المتميزة في الماراثون. إليك معنى كل لقب:
    - **🧠 العقل المدبّر:** يُمنح للعضو الذي جمع **أعلى عدد من النقاط** في المجموع الكلي.
    - **⏳ سيد الساعات:** يُمنح للعضو الذي سجل **أطول وقت قراءة إجمالي** (مجموع قراءة الكتب المشتركة والكتب الحرة).
    - **📚 الديدان القارئ:** يُمنح للعضو الذي **أنهى أكبر عدد من الكتب** (مشتركة وحرة).
    - **💎 صائد الدرر:** يُمنح للعضو الذي أرسل **أكبر عدد من الاقتباسات**.
    - **🏃‍♂️ صاحب النَفَس الطويل:** يُمنح للعضو الأكثر ثباتًا والتزامًا، وهو من سجل القراءة في **أكبر عدد من الأيام المختلفة**.
    - **⚡ العدّاء السريع:** يُمنح للعضو الذي سجل **أعلى عدد من دقائق القراءة في يوم واحد**.
    - **⭐ نجم الأسبوع:** يُمنح للعضو الذي سجل **أعلى مجموع دقائق قراءة خلال أسبوع واحد**.
    - **💪 عملاق الشهر:** يُمنح للعضو الذي سجل **أعلى مجموع دقائق قراءة خلال شهر واحد**.
    """)

# --- Section 3: News Ticker Explained ---
with st.expander("📰 نشرة الماراثون: كيف تعمل \"آخر الأخبار\"؟"):
    st.markdown("""
    شريط الأخبار هو نافذتك على أحدث المستجدات في الماراثون، ويعمل بطريقتين مختلفتين حسب الصفحة:

    #### في لوحة التحكم العامة
    - يعرض الشريط هنا **التغييرات التي طرأت على لوحة شرف الأبطال خلال آخر 7 أيام**.
    - يقوم النظام بمقارنة قائمة الأبطال الحالية بقائمتهم قبل أسبوع، ويرصد أي تغييرات مثل:
        - صعود بطل جديد إلى الصدارة في أحد الألقاب.
        - انضمام منافس جديد ومشاركته اللقب مع بطل حالي.
        - ظهور بطل لأول مرة في لقب كان شاغرًا.
    - الهدف هو تسليط الضوء على الديناميكية والمنافسة على مستوى الماراثون ككل.

    #### في صفحة تحليلات التحديات
    - يركز الشريط هنا على **أحداث التحدي المحدد فقط**.
    - يعرض الأخبار بتسلسل زمني، مع التركيز على آخر المستجدات، مثل:
        - من هو أول عضو أنهى الكتاب المشترك.
        - من هم الأعضاء الآخرون الذين أنهوا الكتاب، ومتى.
        - بعد انتهاء التحدي، يتم عرض خبر عن الأعضاء الذين حضروا جلسة النقاش.
    - الهدف هو متابعة التقدم والإنجازات داخل كل تحدي على حدة.
    """)

# --- Section 4: Q&A ---
with st.expander("🤔 أسئلة شائعة"):
    st.markdown("""
    #### كيف يتم حساب النقاط بالضبط؟
    يتم حساب النقاط بناءً على نظام النقاط الافتراضي الذي يمكنك رؤيته وتعديله. بشكل عام، تحصل على نقاط مقابل:
    - الدقائق التي تقرؤها (للكتب المشتركة والكتب الحرة).
    - إرسال الاقتباسات.
    - إنهاء الكتب.
    - حضور جلسات النقاش.
    يمكنك مراجعة نظام النقاط الحالي من صفحة "الإدارة والإعدادات".

    #### هل يمكنني تعديل نظام النقاط؟
    نعم! كمدير للماراثون، يمكنك الذهاب إلى صفحة "الإدارة والإعدادات" وتعديل نظام النقاط الافتراضي الذي سيطبق على التحديات الجديدة. كما يمكنك تعيين نظام نقاط خاص ومختلف لكل تحدي على حدة عند إنشائه.

    #### ماذا لو نسيت تسجيل قراءتي ليوم ما؟
    لا تقلق. يمكن لمدير الماراثون (أنت) الذهاب إلى صفحة "الإدارة والإعدادات"، ومن ثم إلى تبويب "محرر السجلات". هناك، يمكنك تعديل أي سجل سابق لأي عضو، سواء بتغيير مدة القراءة أو إضافة إنجاز تم نسيانه. بعد الحفظ، يجب إعادة مزامنة البيانات لتعكس التغييرات.
    """)

# --- Section 5: About the Developer ---
st.markdown("---")
with st.expander("🧑‍💻 عن المطور"):
    st.markdown("""
    **الاسم:** احمد نايفه
    
    **الهدف من المشروع:** يهدف هذا المشروع إلى توفير أداة عصرية ومحفزة للمجموعات القرائية في الوطن العربي، للمساهمة في تعزيز ثقافة القراءة وجعلها تجربة تفاعلية وممتعة.
    
    #### **للتواصل والدعم الفني**
    
    إذا واجهتك أي مشكلة تقنية، أو كان لديك اقتراح لتطوير التطبيق، فلا تتردد في التواصل معي عبر أحد الحسابات التالية:

    - **البريد الإلكتروني:** [ahmadnayfeh2000@gmail.com](mailto:ahmadnayfeh2000@gmail.com)
    - **Portfolio:** [ahmadnayfeh.vercel.app](https://ahmadnayfeh.vercel.app/)
    - **LinkedIn:** [in/ahmad-nayfeh2000](https://www.linkedin.com/in/ahmad-nayfeh2000/)
    - **GitHub (للمطورين):** [Ahmad-Nayfeh](https://github.com/Ahmad-Nayfeh)
    
    يسعدني دائماً تلقي ملاحظاتكم واقتراحاتكم لجعل تجربة ماراثون القراءة أفضل للجميع.
    """)

